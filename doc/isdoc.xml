<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article [
<!ATTLIST section xml:id ID #IMPLIED>
<!ATTLIST appendix xml:id ID #IMPLIED>
<!ATTLIST bibliomixed xml:id ID #IMPLIED>
]>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"
  xmlns:sch="http://purl.oclc.org/dsdl/schematron"
  version="5.0" xml:lang="cs">
  <info>
    <title>ISDOC @VERSION@</title>
    <subtitle>Národní standard pro elektronickou fakturaci</subtitle>
    <copyright>
      <year>2014</year>
      <holder>ICT UNIE o.s.</holder>
    </copyright>
    <pubdate><?dbtimestamp padding="0"?></pubdate>
    <releaseinfo revision="6.0.2">Tento dokument byl v době svého publikování ve fázi návrhu. Kdykoliv se může změnit a být nahrazen novější verzí.
      Informace o aktuální verzi standardu ISDOC naleznete na adrese <link xlink:href="http://isdoc.cz"/>.</releaseinfo>
  </info>
  <section xml:id="uvod">
    <title>Úvod</title>
    <para>Tento dokument definuje formáty pro elektronickou fakturaci souhrnně označované zkratkou
      ISDOC. Formát byl definován a je nadále rozvíjen pracovní skupinou pro elektronické standardy
      výměny dat <link xlink:href="http://www.ictu.cz/">ICT Unie o.s.</link>. Veškeré připomínky a
      dotazy k formátu a jeho specifikaci zasílejte na adresu <email>info@isdoc.cz</email>.</para>
    <para>V současné verzi ISDOC definuje formát pro fakturu a neplatební dokument, v dalších verzích může
      být přidána podpora pro další formáty.</para>
    <section xml:id="konvence">
      <title>Konvence</title>
      <para>Pokud se v textu nebo v příkladech objevují prefixy jmenných prostorů, platí pro ně
        následující mapování na jmenný prostor.</para>
      <informaltable frame="all">
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="1.0*"/>
          <colspec colname="c2" colnum="2" colwidth="5.0*"/>
          <thead>
            <row>
              <entry>Prefix</entry>
              <entry>Jmenný prostor</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><code>isdoc</code></entry>
              <entry><uri>http://isdoc.cz/namespace/2013</uri></entry>
            </row>
            <row>
              <entry><code>manifest</code></entry>
              <entry><uri>http://isdoc.cz/namespace/2013/manifest</uri></entry>
            </row>
            <row>
              <entry><code>dsig</code></entry>
              <entry><uri>http://www.w3.org/2000/09/xmldsig#</uri></entry>
            </row>
            <row>
              <entry><code>xades</code></entry>
              <entry><uri>http://uri.etsi.org/01903/v1.3.2#</uri></entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
      <remark>Červený text na žlutém pozadí vyznačuje poznámky editora, které nebudou součástí
        finální verze standardu.</remark>
    </section>
  </section>
  <section xml:id="shoda">
    <title>Shoda se standardem</title>
    <para>Standard ISDOC definuje shodu pro dokumenty, konzumenty a producenty.</para>
    <section xml:id="typy-dokumentu">
      <title>Typy dokumentů ISDOC</title>
      <para>Standard ISDOC definuje následující typy dokumentů:</para>
      <itemizedlist>
        <listitem>
          <para>daňový doklad – souhrnně označuje fakturu, opravný daňový doklad (dobropis), opravný
            daňový doklad (vrubopis), zálohovou fakturu (nedaňový zálohový list), daňový doklad při
            přijetí platby (daňový zálohový list), opravný daňový doklad při přijetí platby
            (dobropis daňového zálohového listu)a zjednodušený daňový doklad;</para>          
        </listitem>
        <listitem>
          <para>neplatební dokument.</para>
        </listitem>        
      </itemizedlist>
    </section>
    <section xml:id="shoda-dokument">
      <title>Dokument ISDOC</title>
      <para>Dokument ISDOC musí splňovat následující požadavky:</para>
      <orderedlist>
        <listitem>
          <para>Musí být reprezentován v souladu s požadavky definovanými v části <xref
              linkend="reprezentace"/>.</para>
        </listitem>
        <listitem>
          <para>Musí být jedním z typů dokumentů definovaných v tomto standardu:</para>
          <itemizedlist>
            <listitem>
              <para>Pokud se jedná o daňový doklad, musí být validní vůči schématu uvedenému v části
                  <xref linkend="schema-invoice"/> a jako kořenový element musí být použit element
                  <tag>Invoice</tag>.</para>
            </listitem>
            <listitem>
              <para>Pokud se jedná o neplatební dokument, musí být validní vůči schématu uvedenému v části
                <xref linkend="schema-commondocument"/> a jako kořenový element musí být použit element
                <tag>CommonDocument</tag>.</para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>Musí splňovat pravidla definovaná v části <xref linkend="pravidla"/>.</para>
        </listitem>
        <listitem>
          <para>Pokud je dokument opatřen digitálním podpisem, musí splňovat požadavky definované v části <xref linkend="podpis"/>.</para>
        </listitem>
        <listitem>
          <para>Pokud je dokument opatřen časovým razítkem, musí splňovat požadavky definované v části <xref linkend="razitko"/>.</para>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="shoda-konzument">
      <title>Konzument ISDOC</title>
      <para>Konzument ISDOC je program, který načítá a zpracovává dokument ISDOC v souladu se
        sémantikou definovanou v tomto standardu. Konzument musí být schopen načíst a zpracovat
        alespoň jeden typ dokumentů ISDOC.</para>
      <para>Konzument ISDOC musí být opatřen dokumentací, která vyjmenovává jaké typy dokumentů
        ISDOC a jaké verze standardu ISDOC jsou podporovány.</para>
    </section>
    <section xml:id="shoda-producent">
      <title>Producent ISDOC</title>
      <para>Producent ISDOC je program, který generuje dokument ISDOC v souladu se sémantikou
        definovanou v tomto standardu. Producent musí být schopen generovat alespoň jeden typ
        dokumentů ISDOC.</para>
      <para>Producent ISDOC musí být opatřen dokumentací, která vyjmenovává jaké typy dokumentů
        ISDOC a jaké verze standardu ISDOC jsou podporovány.</para>
    </section>
  </section>
  <section xml:id="reprezentace">
    <title>Reprezentace dokumentu</title>
    <para>Dokument ISDOC musí být reprezentován jako samostatný dokument XML, jako PDF/A-3 dokument
      (tzv ISDOC.PDF) nebo jako archiv. Pro samostatné dokumenty je doporučeno používat příponu
        <filename>.isdoc</filename> a pro archivy <filename>.isdocx</filename>. Jméno dokumentů
      ISDOC.PDF by mělo být zakončeno řetězcem <filename>-isdoc.pdf</filename>.</para>
    <note>
      <para>Samostatný dokument je preferovaná forma pro výměnu dokumentů ISDOC. Je vhodná například
        při komunikace pomocí webových služeb či pro zasílání dokumentů pomocí elektronické pošty
        nebo datových schránek. Reprezentace pomocí archivu je vhodná v případech, kdy chceme kromě
        samotného dokladu přenášet i další související přílohy jako jeden celek. Reprezentace
        ISDOC.PDF je vhodná v případě, kdy chceme příjemci dokladu umožnit snadnou vizuální kontrolu
        a přitom zachovat možnost strojového zpracování.</para>
    </note>
    <section xml:id="reprezentace-xml">
      <title>Dokument XML</title>
      <para>ISDOC musí být well-formed dokument XML tak jak definuje specifikace <xref
          linkend="bib.xml"/> a musí být uložen v kódování UTF-8.</para>
    </section>
    <section xml:id="reprezentace-isdoc.pdf">
      <title>ISDOC.PDF</title>
      <para/>
    </section>
    <section xml:id="archiv">
      <title>Archiv</title>
      <para>Archiv obsahující dokument ISDOC musí používat formát ZIP tak jak jej definuje
        specifikace <xref linkend="bib.appnote"/> a navíc musí dodržet všechny následující
        požadavky:</para>
      <orderedlist>
        <listitem>
          <para>Soubory uložené v archivu musí být nekomprimované nebo musí používat kompresní
            metodu <quote>deflate</quote> popsanou v <xref linkend="bib.rfc1951"/>.</para>
        </listitem>
        <listitem>
          <para>Archiv nesmí používat šifrování.</para>
        </listitem>
        <listitem>
          <para>Archiv nesmí používat digitální podpisy.</para>
        </listitem>
        <listitem>
          <para>Archiv nesmí používat funkci <quote>patch data</quote>.</para>
        </listitem>
        <listitem>
          <para>Archiv nesmí být rozdělen do více souborů.</para>
        </listitem>
        <listitem>
          <para>Jména souborů musí být uložena v kódování UTF-8 a musí být nastaven příznak
              <quote>Language encoding flag</quote> (bit 11).</para>
        </listitem>
        <listitem>
          <para>Archiv musí v kořenovém adresáři obsahovat soubor <filename>manifest.xml</filename>
            obsahující manifest.</para>
        </listitem>
      </orderedlist>
      <section xml:id="manifest">
        <title>Manifest</title>
        <para>Manifest je jednoduchý dokument XML, který slouží k snadnému a rychlému nalezení
          dokumentu ISDOC v archivu. Elementy uvnitř manifestu musí být ve jmenném prostoru
            <uri>http://isdoc.cz/namespace/2013/manifest</uri>. Manifest musí obsahovat kořenový
          element <tag>manifest</tag> a ten musí obsahovat právě jeden element
            <tag>maindocument</tag>, který v atributu <tag class="attribute">filename</tag> určuje
          umístění dokumentu ISDOC uvnitř archivu.</para>
        <example>
          <title>Manifest archivu – soubor <filename>manifest.xml</filename></title>
          <programlisting>&lt;?xml version="1.0"?>
&lt;manifest xmlns="http://isdoc.cz/namespace/2013/manifest">
  &lt;maindocument filename="FV2013-042.isdoc"/>
&lt;/manifest></programlisting>
        </example>
        <note>
          <para>Starší verze formátu ISDOC nepodporovaly manifest (do verze 5.x včetně). Pro
            zajištění zpětné kompatibility je doporučeno, aby aplikace v případě chybějícího
            manifestu za hlavní dokument ISDOC v archivu považovala soubor v hlavním adresáři
            archivu, který má příponu <filename>.isdoc</filename>.</para>
        </note>
      </section>
    </section>
  </section>
  <section xml:id="pravidla">
    <title>Pravidla</title>
    <para>Jednotlivé typy dokumentů ISDOC musí splňovat následující pravidla. Některá z následujících pravidel lze 
    kontrolovat strojově pomocí schématu v jazyce Schematron. Odpovídající schéma je v příloze <xref linkend="schematron"/>. 
    </para>
    <section xml:id="pravidla-invoice">
      <title>Pravidla pro typ dokumentu daňový doklad</title>
      <section xml:id="invoice-rule-1">
        <info>
          <title>Vazba na původní doklad</title>
          <sch:rule context="isdoc:Invoice[isdoc:DocumentType = (2,3,6)]">
            <sch:assert test="isdoc:OriginalDocumentReferences/*"/>
          </sch:rule>
        </info>
        <para>Pro typ dokladu 2, 3 a 6 musí existovat vazba na původní doklad. Konkrétně tedy pro <tag>DocumentType</tag> = 2, 3, 6 musí existovat element <tag>OriginalDocumentReference</tag> a musí byt neprázdný.</para>
      </section>
      <section xml:id="invoice-rule-2">
        <info>
          <title>Konzistentní uvádění cizí měny</title>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:LineExtensionAmount]">
            <sch:assert test="isdoc:LineExtensionAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:LineExtensionAmountTaxInclusive]">
            <sch:assert test="isdoc:LineExtensionAmountTaxInclusiveCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:DepositAmount]">
            <sch:assert test="isdoc:DepositAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:TaxableDepositAmount]">
            <sch:assert test="isdoc:TaxableDepositAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:TaxInclusiveDepositAmount]">
            <sch:assert test="isdoc:TaxInclusiveDepositAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:TaxAmount]">
            <sch:assert test="isdoc:TaxAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:TaxableAmount]">
            <sch:assert test="isdoc:TaxableAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:TaxInclusiveAmount]">
            <sch:assert test="isdoc:TaxInclusiveAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:AlreadyClaimedTaxableAmount]">
            <sch:assert test="isdoc:AlreadyClaimedTaxableAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:AlreadyClaimedTaxAmount]">
            <sch:assert test="isdoc:AlreadyClaimedTaxAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:AlreadyClaimedTaxInclusiveAmount]">
            <sch:assert test="isdoc:AlreadyClaimedTaxInclusiveAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:DifferenceTaxableAmount]">
            <sch:assert test="isdoc:DifferenceTaxableAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:DifferenceTaxAmount]">
            <sch:assert test="isdoc:DifferenceTaxAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:DifferenceTaxInclusiveAmount]">
            <sch:assert test="isdoc:DifferenceTaxInclusiveAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:TaxExclusiveAmount]">
            <sch:assert test="isdoc:TaxExclusiveAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:AlreadyClaimedTaxExclusiveAmount]">
            <sch:assert test="isdoc:AlreadyClaimedTaxExclusiveAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:DifferenceTaxExclusiveAmount]">
            <sch:assert test="isdoc:DifferenceTaxExclusiveAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:PayableRoundingAmount]">
            <sch:assert test="isdoc:PayableRoundingAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:PaidDepositsAmount]">
            <sch:assert test="isdoc:PaidDepositsAmountCurr"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]//*[isdoc:PayableAmount]">
            <sch:assert test="isdoc:PayableAmountCurr"/>
          </sch:rule>          
        </info>
        <para>Doklad vystavený v cizí měně musí obsahovat v cizí měně i všechny finanční elementy. Konkrétně: pokud existuje element <tag>ForeignCurrencyCode</tag>, pak musí existovat všechny elementy s částkami pro cizí měnu tj. ty končící na <code>Curr</code>.</para>        
      </section>
      <section xml:id="invoice-rule-3">
        <info>
          <title>Konzistentní uvádění tuzemské měny</title>
          <sch:rule context="isdoc:Invoice[not(isdoc:ForeignCurrencyCode)]">
            <sch:assert test="isdoc:CurrRate = 1"/>
            <sch:assert test="isdoc:RefCurrRate = 1"/>
          </sch:rule>
          <sch:rule context="isdoc:Invoice[not(isdoc:ForeignCurrencyCode)]">
            <sch:assert test="not(.//isdoc:LineExtensionAmountCurr)"/>
            <sch:assert test="not(.//isdoc:LineExtensionAmountTaxInclusiveCurr)"/>
            <sch:assert test="not(.//isdoc:DepositAmountCurr)"/>
            <sch:assert test="not(.//isdoc:TaxableDepositAmountCurr)"/>
            <sch:assert test="not(.//isdoc:TaxInclusiveDepositAmountCurr)"/>
            <sch:assert test="not(.//isdoc:TaxAmountCurr)"/>
            <sch:assert test="not(.//isdoc:TaxableAmountCurr)"/>
            <sch:assert test="not(.//isdoc:TaxInclusiveAmountCurr)"/>
            <sch:assert test="not(.//isdoc:AlreadyClaimedTaxableAmountCurr)"/>
            <sch:assert test="not(.//isdoc:AlreadyClaimedTaxAmountCurr)"/>
            <sch:assert test="not(.//isdoc:AlreadyClaimedTaxInclusiveAmountCurr)"/>
            <sch:assert test="not(.//isdoc:DifferenceTaxableAmountCurr)"/>
            <sch:assert test="not(.//isdoc:DifferenceTaxAmountCurr)"/>
            <sch:assert test="not(.//isdoc:DifferenceTaxInclusiveAmountCurr)"/>
            <sch:assert test="not(.//isdoc:TaxExclusiveAmountCurr)"/>
            <sch:assert test="not(.//isdoc:AlreadyClaimedTaxExclusiveAmountCurr)"/>
            <sch:assert test="not(.//isdoc:DifferenceTaxExclusiveAmountCurr)"/>
            <sch:assert test="not(.//isdoc:PayableRoundingAmountCurr)"/>
            <sch:assert test="not(.//isdoc:PaidDepositsAmountCurr)"/>
            <sch:assert test="not(.//isdoc:PayableAmountCurr)"/>
          </sch:rule>
        </info>
        <para>Doklad vystavený v tuzemské měně nesmí obsahovat žádný element v cizí měně. Pokud neexistuje element <tag>ForeignCurrencyCode</tag>, pak nesmí existovat žádný element pro cizí měnu, tj. element končící na <code>Curr</code>. Položky s kursem (<tag>CurrRate</tag> i <tag>RefCurrRate</tag>) musí být rovny hodnotě 1.</para>        
      </section>
      <section xml:id="invoice-rule-4">
        <info>
          <title>Tuzemská a zahraniční měna musí být rozdílná</title>
          <sch:rule context="isdoc:Invoice[isdoc:ForeignCurrencyCode]">
            <sch:assert test="isdoc:ForeignCurrencyCode != isdoc:LocalCurrencyCode"/>            
          </sch:rule>
        </info>
        <para>U dokladu v zahraniční měně nesmí být měna lokální a zahraniční shodné. Konkrétně hodnota povinné položky <tag>LocalCurrencyCode</tag> se nesmí rovnat hodnotě nepovinné položky <tag>ForeignCurrencyCode</tag>.</para>
      </section>
      <section xml:id="invoice-rule-5">
        <info>
          <title>Nedaňový doklad nesmí obsahovat řádkové položky podléhající DPH</title>
          <sch:rule context="isdoc:Invoice[isdoc:VATApplicable = 'false']">
            <sch:assert test="every $va in isdoc:InvoiceLines/isdoc:InvoiceLine/isdoc:ClassifiedTaxCategory/isdoc:VATApplicable satisfied $va = 'false'"/>            
          </sch:rule>
        </info>
        <para>Je-li doklad nedaňový (element <tag>VATApplicable</tag> obsahuje hodnotu
            <literal>false</literal>), musejí být i všechny jeho řádkové položky nedaňové, tedy
          element <tag>VATApplicable</tag> uvnitř elementu <tag>ClassifiedTaxCategory</tag> rovněž
          obsahuje hodnotu <literal>false</literal>. Obráceně to však neplatí – na dokladu
          podléhajícím DPH mohou být jednotlivé položky, které nejsou v evidenci DPH.</para>
      </section>
      <section xml:id="invoice-rule-6">
        <info>
          <title>Jednotky jednotlivých šarží v jedné řádce musí být stejné a odpovídat jednotce množství pro celou řádku</title>
          <sch:rule context="isdoc:Invoice/isdoc:InvoiceLines/isdoc:InvoiceLine[isdoc:Item/isdoc:StoreBatches]">
            <sch:assert test="count(distinct-values(isdoc:Item/isdoc:StoreBatches/isdoc:StoreBatch/isdoc:Quantity/@unitCode)) le 1"/>            
            <sch:assert test="if (isdoc:InvoicedQuantity/@unitCode) then
                                every $q in isdoc:Item/isdoc:StoreBatches/isdoc:StoreBatch/isdoc:Quantity) satisfies $q/@unitCode = isdoc:InvoicedQuantity/@unitCode
                              else true()"/>
          </sch:rule>
        </info>
        <para>Jednotka v rozpisu všech šarží/sériových čísel (element
          <tag>StoreBatches</tag>) musí být stejná jako jednotka pro množství na řádce faktury.
          Jednotky u šarží jedné řádky faktury musí být stejné.
          Pokud atribut pro jednotku v rozpisu šarží/sériových čísel není uveden, 
          tak se předpokládá, že je množství uvedeno ve stejné jednotce
          jako množství na řádce faktury. </para>
      </section>
      <section xml:id="invoice-rule-7">
        <info>
          <title>Součet množství za jednotlivé šarže musí odpovídat množství za celou řádku</title>
          <sch:rule context="isdoc:Invoice/isdoc:InvoiceLines/isdoc:InvoiceLine[isdoc:Item/isdoc:StoreBatches]">
            <sch:assert test="sum(isdoc:Item/isdoc:StoreBatches/isdoc:StoreBatch/isdoc:Quantity) = isdoc:InvoicedQuantity"/>            
          </sch:rule>
        </info>
        <para>Součet <tag>Quantity</tag> ze všech záznamů rozpisu šarží/sériových čísel musí odpovídat <tag>InvoicedQuantity</tag> dané řádky faktury.</para>
      </section>
      <section xml:id="invoice-rule-8">
        <info>
          <title>Sekundární identifikace zboží může být uvedena pouze v případě, že je uvedena i primární</title>
          <sch:rule context="isdoc:Invoice/isdoc:InvoiceLines/isdoc:InvoiceLine/isdoc:Item[isdoc:SecondarySellersItemIdentification]">
            <sch:assert test="isdoc:SellersItemIdentification"/>            
          </sch:rule>
        </info>
        <para>Nepovinnou položku <tag>SecondarySellersItemIdentification</tag> lze uvést pouze v případě, že je uvedena také položka <tag>SellersItemIdentification</tag>.</para>
      </section>
      <section xml:id="invoice-rule-9">
        <info>
          <title>Terciální identifikace zboží může být uvedena pouze v případě, že je uvedena i primární a sekundární</title>
          <sch:rule context="isdoc:Invoice/isdoc:InvoiceLines/isdoc:InvoiceLine/isdoc:Item[isdoc:TertiarySellersItemIdentification]">
            <sch:assert test="isdoc:SellersItemIdentification and isdoc:SecondarySellersItemIdentification"/>            
          </sch:rule>
        </info>
        <para>Nepovinnou položku <tag>TertiarySellersItemIdentification</tag> lze uvést pouze v případě, že jsou uvedeny také položky <tag>SellersItemIdentification</tag> a <tag>SecondarySellersItemIdentification</tag>.</para>
      </section>
      <section xml:id="invoice-rule-sdt-origin">
        <info>
          <title>Správce číselníku podrobnějšího typu dokumentu</title>
        </info>
        <para>Element <tag>SubDocumentTypeOrigin</tag> musí obsahovat pouze hodnoty uvedené v tabulce <xref linkend="tab.std-origin"/>.</para>
        <table xml:id="tab.std-origin">
          <title>Přípustné hodnoty pro element <tag>SubDocumentTypeOrigin</tag></title>
          <tgroup cols="4">
            <colspec colwidth="1*"/>
            <colspec colwidth="3*"/>
            <colspec colwidth="2*"/>
            <colspec colwidth="2*"/>
            <thead>
              <row>
                <entry>Hodnota</entry>
                <entry>Popis</entry>
                <entry>Definice číselníku</entry>
                <entry>Přidáno</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><code>CBA</code></entry>
                <entry>Česká bankovní asociace</entry>
                <entry>viz <xref linkend="bib.cba29"/></entry>
                <entry>1. ledna 2014</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>
    </section>
    <section xml:id="pravidla-commondocument">
      <title>Pravidla pro typ dokumentu neplatební dokument</title>
      <section xml:id="commondocument-rule-sdt-origin">
        <info>
          <title>Správce číselníku podrobnějšího typu dokumentu</title>
        </info>
        <para>Element <tag>SubDocumentTypeOrigin</tag> musí obsahovat pouze hodnoty uvedené v tabulce <xref linkend="tab.std-origin"/>.</para>
      </section>
    </section>      
  </section>
  <section xml:id="podpis">
    <title>Digitální podpisy</title>
    <section xml:id="podpis-pozadavky">
      <title>Požadavky na digitální podpis v dokumentu ISDOC</title>
      <orderedlist>
        <listitem>
          <para>Digitální podpis musí být v souladu s doporučením <xref linkend="bib.xmldsig-core"
            />.</para>
        </listitem>
        <listitem>
          <para>Digitální podpis musí používat transformaci <link
              xlink:href="http://www.w3.org/TR/xmldsig-core/#sec-EnvelopedSignature">Enveloped
              Signature</link> a být uložen v elementu <tag>Signature</tag> ze jmenného prostoru
              <uri>http://www.w3.org/2000/09/xmldsig#</uri>, který je vždy posledním elementem
            uvnitř kořenového elementu dokument ISDOC (např. <tag>Invoice</tag>).</para>
        </listitem>
        <listitem>
          <para>Je doporučeno, aby kromě transformace <link
              xlink:href="http://www.w3.org/TR/xmldsig-core/#sec-EnvelopedSignature">Enveloped
              Signature</link> byla použita i transformace <link
              xlink:href="http://www.w3.org/TR/xmldsig-core/#sec-XPath">XPath</link>, která umožní
            pozdější přidání dalších podpisů tím, že podpisy samotné se vynechají z podepisování
            pomocí XPath filtru <code>not(ancestor-or-self::dsig:Signature)</code>.</para>
          <example>
            <title>Použití transformace XPath v digitálním podpisu</title>
            <programlisting>&lt;Signature xmlns="http://www.w3.org/2000/09/xmldsig#"
           <emphasis role="bold">xmlns:dsig="http://www.w3.org/2000/09/xmldsig#"</emphasis>
           Id="Signature-1">
  &lt;SignedInfo>
    &lt;CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/>
    &lt;SignatureMethod Algorithm="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"/>
    &lt;Reference URI="">
<emphasis role="bold">      &lt;Transforms>
        &lt;Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
        &lt;Transform Algorithm="http://www.w3.org/TR/1999/REC-xpath-19991116">
          &lt;XPath>not(ancestor-or-self::dsig:Signature)&lt;/XPath>
         &lt;/Transform>
      &lt;/Transforms></emphasis>
      &lt;DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
      &lt;DigestValue>GRhVFHn8P5AoMcL0y1RJ4ICVRQZKdW+hcxo3gz8gvCc=&lt;/DigestValue>
    &lt;/Reference>
  &lt;/SignedInfo>
  &lt;SignatureValue>...&lt;/SignatureValue>
  &lt;KeyInfo>
    &lt;X509Data>
      &lt;X509Certificate>...&lt;/X509Certificate>
    &lt;/X509Data>
  &lt;/KeyInfo>
&lt;/Signature></programlisting>
          </example>
        </listitem>
        <listitem>
          <para>Je doporučeno, aby každý připojený digitální podpis obsahoval unikátní identifikátor
            uvnitř atributu <tag class="attribute">Id</tag>. Hodnota identifikátoru musí odpovídat
            produkčnímu pravidlu <literal xlink:href="http://www.w3.org/TR/REC-xml/#NT-Name"
              >Name</literal> tak, jak jej definuje specifikace <xref linkend="bib.xml"/>.<footnote>
              <para>Například nesmí začínat číslem, nesmí obsahovat mezery atd.</para>
            </footnote></para>
          <example>
            <title>Přiřazení unikátního identifikátoru podpisu</title>
            <programlisting>&lt;Signature xmlns="http://www.w3.org/2000/09/xmldsig#"
           xmlns:dsig="http://www.w3.org/2000/09/xmldsig#"
           <emphasis role="bold">Id="Signature-1"</emphasis>>
  ...
&lt;/Signature></programlisting>
          </example>
        </listitem>
        <listitem>
          <para>Jako algoritmus pro výpočet otisku dokumentu se musí používat algoritmus z rodiny
            SHA-2. Algoritmus musí být identifikován v souladu s <xref linkend="bib.rfc4051"
            />.</para>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="podpis-vicenasobny-pozadavky">
      <title>Požadavky na vícenásobný podpis dokumentu ISDOC</title>
      <orderedlist>
        <listitem>
          <para >Podpis musí být v souladu s požadavky definovanými v <xref
              linkend="podpis-pozadavky"/>.</para>
        </listitem>
        <listitem>
          <para>Musí být použita transformace <link
              xlink:href="http://www.w3.org/TR/xmldsig-core/#sec-XPath">XPath</link> a to
            následujícím způsobem:</para>
          <orderedlist>
            <listitem>
              <para>První podpis používá filtr
                <code>not(ancestor-or-self::dsig:Signature)</code>.</para>
            </listitem>
            <listitem>
              <para>Další podpisy používají filtr <code>not(ancestor-or-self::dsig:Signature) or
                    not(ancestor-or-self::dsig:Signature/preceding-sibling::dsig:Signature[<replaceable>N</replaceable>-1])</code>,
                kde <replaceable>N</replaceable> je pořadí přidávaného podpisu (číslované od
                jedna).</para>
            </listitem>
          </orderedlist>
        </listitem>
      </orderedlist>
    </section>
    <section xml:id="podpis-vicenasobny-stare-dokumenty">
      <title>Ověření vícenásobného podpisu ve starších verzích formátu</title>
      <para>Do verze ISDOC 5.3.x mohly aplikace produkovat vícenásobné <quote>enveloped</quote> podpisy bez použití transformace
        XPath. Selže-li jejich ověření standardním postupem, postupuje se následovně:</para>
      <orderedlist>
        <listitem>
          <para>Pokud dokument obsahuje alespoň jeden digitální podpis, ověří se poslední digitální
            podpis.</para>
        </listitem>
        <listitem>
          <para>Poslední digitální podpis (element <tag>Signature</tag>) se z dokumentu odstraní a s takto upraveným dokumentem se opakuje krok 1.</para>
        </listitem>
      </orderedlist>
    </section>
  </section>
  <section xml:id="razitko">
    <title>Časové razítko</title>

<section xml:id="razitko-pozadavky">
  <title>Požadavky na časové razítko v dokumentu ISDOC</title>
  <orderedlist>
      
      <listitem>
        <para>Dokument ISDOC musí obsahovat digitální podpis v souladu s <xref
            linkend="podpis-pozadavky"/> a rozhodnutím komise <xref linkend="bib.2011-130-eu"
          />.</para>
      </listitem>
      <listitem>
        <para>Digitální podpis, který je předmětem časového razítka, musí obsahovat unikátní
          identifikátor uvnitř atributu <tag class="attribute">Id</tag> elementu
            <tag>Signature</tag>.</para>
      </listitem>
      <listitem>
        <para>Časové razítko musí být ve formě XAdES-T v souladu se specifikací <xref
            linkend="bib.xades"/>.</para>
      </listitem>
      <listitem>
        <para>Digitální podpis, který je předmětem časového razítka, musí obsahovat podpisový
          certifikát uvnitř elementu <tag>KeyInfo</tag> (viz sekce 4.4.1 <xref linkend="bib.xades"
          />) a otisk podpisového certifikátu musí být součástí podepisovaných dat.<footnote>
            <para>Povinnost zahrnout podpisový certifikát do podpisu definuje forma XAdES-BES.
              Časové razítko ve formě XAdES-T musí splňovat i všechny požadavky na nižší formu
              XAdES-BES (resp. XAdES-EPES).</para>
          </footnote></para>
      </listitem>
      <listitem>
        <para>Autoritě časového razítka se posílá otisk hodnoty digitálního podpisu v elementu
              <tag>SignatureValue</tag>.<footnote>
              <para>Otisk se přitom počítá z textového obsahu elementu <tag>SignatureValue</tag>
                nikoliv z binární reprezentace hodnoty digitálního podpisu. Před výpočtem otisku se
                ještě provádí kanonizace.</para>
            </footnote> Pro výpočet otisku musí být použit algoritmus z rodiny SHA-2.<footnote>
              <para>V současné době většina autorit časového razítka v ČR podporuje pouze algoritmus
                SHA-256.</para>
            </footnote></para>
      </listitem>
      <listitem>
        <para>Časové razítko obdržené od autority časového razítka musí být uloženo v elementu
              <tag>EncapsulatedTimeStamp</tag> ve formátu ASN.1 zakódovaném v DER a následně pomocí
            base64. Časové razítko musí vyhovovat formátu definovanému produkčním pravidlem
              <literal>TimeStampToken</literal> dle <xref linkend="bib.rfc3161"/>.</para>
      </listitem>
    </orderedlist>
    <example>
      <title>ISDOC s digitálními podpisy výstavce, příjemce a časovým razítkem</title>
      <programlisting>&lt;?xml version="1.0" encoding="utf-8"?>
&lt;Invoice xmlns="http://isdoc.cz/namespace/2013" version="5.2.2">
  &lt;DocumentType>1&lt;/DocumentType>
  <emphasis role="italic">... samotný obsah faktury ve formátu ISDOC ...</emphasis>
  &lt;Signature<co xml:id="dsig-vystavce"/> xmlns="http://www.w3.org/2000/09/xmldsig#"
             xmlns:dsig="http://www.w3.org/2000/09/xmldsig#">
    &lt;SignedInfo>
      &lt;CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/>
      &lt;SignatureMethod Algorithm="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"/>
      &lt;Reference URI="">
        &lt;Transforms>
          &lt;Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
          &lt;Transform Algorithm="http://www.w3.org/TR/1999/REC-xpath-19991116">
            &lt;XPath>not(ancestor-or-self::dsig:Signature)&lt;/XPath>
           &lt;/Transform>
        &lt;/Transforms>
        &lt;DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
        &lt;DigestValue>GRhVFHn8P5AoMcL0y1RJ4ICVRQZKdW+hcxo3gz8gvCc=&lt;/DigestValue>
      &lt;/Reference>
    &lt;/SignedInfo>
    &lt;SignatureValue>w6sA...
      <emphasis>samotný digitální podpis zakódovaný pomocí base64</emphasis>
      ...45pg==&lt;/SignatureValue>
    &lt;KeyInfo>
      &lt;X509Data>
        &lt;X509Certificate>MIIE...
          <emphasis>X.509 v3 certifikát ve formátu ASN.1/DER zakódovaný pomocí base64</emphasis>
          ...RQkP&lt;/X509Certificate>
      &lt;/X509Data>
    &lt;/KeyInfo>
  &lt;/Signature>
  &lt;Signature<co xml:id="dsig-prijemce"/> xmlns="http://www.w3.org/2000/09/xmldsig#" Id<co xml:id="dsig-id"/>="Signature-2"
             xmlns:dsig="http://www.w3.org/2000/09/xmldsig#">
    &lt;SignedInfo<co xml:id="dsig-si"/>>
      &lt;CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/>
      &lt;SignatureMethod Algorithm="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"/>
      &lt;Reference<co xml:id="dsig-ref1"/> Id<co xml:id="dsig-ref1-id"/>="Signature-2-Document-Reference" URI="">
        &lt;Transforms>
          &lt;Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
          &lt;Transform Algorithm="http://www.w3.org/TR/1999/REC-xpath-19991116">
            &lt;XPath>not(ancestor-or-self::dsig:Signature) or not(ancestor-or-self::dsig:Signature/preceding-sibling::dsig:Signature[1])&lt;/XPath>
           &lt;/Transform>
        &lt;/Transforms>
        &lt;DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
        &lt;DigestValue>yHcv2564yvtGgJZcG4+1dm/jsmlX0qKGjGWUfu5cGpg=&lt;/DigestValue>
      &lt;/Reference>
      &lt;Reference<co xml:id="dsig-ref2"/> URI<co xml:id="dsig-ref2-uri"/>="#Signature-2-SignedProperties">
        &lt;DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
        &lt;DigestValue>iEy8FDlFUlbctpiVrwTf4cuTBKoBBXY5LDJIyuAG2KM=&lt;/DigestValue>
      &lt;/Reference>
    &lt;/SignedInfo>
    &lt;SignatureValue>OcLa...
      <emphasis>samotný digitální podpis zakódovaný pomocí base64</emphasis>
      ...t+jA==&lt;/SignatureValue>
    &lt;KeyInfo<co xml:id="dsig-ki"/>>
      &lt;X509Data>
        &lt;X509Certificate>MIIE...
          <emphasis>X.509 v3 certifikát ve formátu ASN.1/DER zakódovaný pomocí base64</emphasis>
          ...I2si0=&lt;/X509Certificate>
      &lt;/X509Data>
    &lt;/KeyInfo>
    &lt;Object<co xml:id="dsig-object"/>>
      &lt;xades:QualifyingProperties<co xml:id="dsig-xades-qp"/> xmlns:xades="http://uri.etsi.org/01903/v1.3.2#"
                                    Target<co xml:id="dsig-xades-target"/>="#Signature-2">        
        &lt;xades:SignedProperties<co xml:id="dsig-xades-sp"/> Id="Signature-2-SignedProperties">
          &lt;xades:SignedSignatureProperties>
            &lt;xades:SigningTime<co xml:id="dsig-xades-st"/>>2011-08-16T08:25:48.0724613Z&lt;/xades:SigningTime>
            &lt;xades:SigningCertificate<co xml:id="dsig-xades-sc"/>>
              &lt;xades:Cert>
                &lt;xades:CertDigest>
                  &lt;DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
                  &lt;DigestValue<co xml:id="dsig-xades-dv"/>>2w6LNdUhsrbRSWpoZhYKGo5BO1GmVzDuhZ7QOE5NgFg=&lt;/DigestValue>
                &lt;/xades:CertDigest>
                &lt;xades:IssuerSerial<co xml:id="dsig-xades-is"/>>
                  &lt;X509IssuerName>C=CZ, O="Česká pošta, s.p. [IČ 47114983]", CN=DEMO PostSignum
                    Qualified CA 2&lt;/X509IssuerName>
                  &lt;X509SerialNumber>07B4E9&lt;/X509SerialNumber>
                &lt;/xades:IssuerSerial>
              &lt;/xades:Cert>
            &lt;/xades:SigningCertificate>
          &lt;/xades:SignedSignatureProperties>
          &lt;xades:SignedDataObjectProperties>
            &lt;xades:DataObjectFormat<co xml:id="dsig-xades-dof"/> ObjectReference="#Signature-2-Document-Reference">
              &lt;xades:MimeType>application/xml&lt;/xades:MimeType>
            &lt;/xades:DataObjectFormat>
          &lt;/xades:SignedDataObjectProperties>
        &lt;/xades:SignedProperties>
        &lt;xades:UnsignedProperties>
          &lt;xades:UnsignedSignatureProperties>
            &lt;xades:SignatureTimeStamp>
              &lt;xades:EncapsulatedTimeStamp<co xml:id="dsig-xades-ets"/>
                     Encoding="http://uri.etsi.org/01903/v1.2.2#DER">MIIOB...
                <emphasis>Časové razítko zakódované v ASN.1/DER a následně base64</emphasis>
                ...qp8=&lt;/xades:EncapsulatedTimeStamp>
            &lt;/xades:SignatureTimeStamp>
          &lt;/xades:UnsignedSignatureProperties>
        &lt;/xades:UnsignedProperties>
      &lt;/xades:QualifyingProperties>
    &lt;/Object>
  &lt;/Signature>
&lt;/Invoice></programlisting>
      <calloutlist>
        <callout arearefs="dsig-vystavce">
          <para>Digitální podpis výstavce dokumentu. Podepsán je původní obsah faktury.</para>
        </callout>
        <callout arearefs="dsig-prijemce">
          <para>Digitální podpis příjemce dokumentu. Podepsán je celý předcházející dokument – tedy
            jak původní obsah faktury tak podpis výstavce. Navíc je kvůli požadavkům na shodu
            s XAdES-BES podepsán i podpisový certifikát příjemce (viz <coref linkend="dsig-ref2"
            />).</para>
        </callout>
        <callout arearefs="dsig-id">
          <para>Digitální podpis, který chceme opatřit časovým razítkem, musí mít unikátní
            identifikátor. Časové razítko pomocí odkazu na identifikátor indikuje, kterého podpisu
            se týká.</para>
        </callout>
        <callout arearefs="dsig-si">
          <para>Element <tag>SignedInfo</tag> obsahuje informace o podepisovaných datech, způsobu
            jejich kanonizace a metodě výpočtu podpisu.</para>
        </callout>
        <callout arearefs="dsig-ref1">
          <para>Element <tag>Reference</tag> určuje data pro podepsání. Atribut <code>URI=""</code>
            říká, že se bude podepisovat celý stávající dokument (v našem případě původní faktura a
            podpis výstavce).</para>
        </callout>
        <callout arearefs="dsig-ref1-id">
          <para>Element <tag>Reference</tag> musí mít přiřazen identifikátor, aby se na něj bylo
            možné odkázat z elementu <tag>DataObjectFormat</tag> (viz <coref
              linkend="dsig-xades-dof"/>).</para>
        </callout>
        <callout arearefs="dsig-ref2">
          <para>Element <tag>Reference</tag> určuje data pro podepsání. Atribut
              <code>URI="#Signature-2-SignedProperties"</code> říká, že se bude podepisovat element,
            který má identifikátor <code>Signature-2-SignedProperties</code>. V našem případě se
            jedná o element <tag>SignedProperties</tag> obsahující čas podepisování, otisk
            podpisového certifikátu (viz <coref linkend="dsig-xades-sc"/>) a další informace.
            Zahrnutí těchto údajů do podpisu vyžaduje XAdES-BES.</para>
        </callout>
        <callout arearefs="dsig-ref2-uri">
          <para>Odkaz na podepisovaná data, v tomto případě na element <tag>SignedProperties</tag>
            (viz <coref linkend="dsig-xades-sp"/>) obsahující zejména otisk podpisového
            certifikátu.</para>
        </callout>
        <callout arearefs="dsig-ki">
          <para>Element <tag>KeyInfo</tag> obsahuje podpisový certifikát. XAdES-BES vyžaduje, aby
              byl tento certifikát přítomen a byl podepsán jeho otisk v elementu
                <tag>SigningCertificate</tag>.</para>
        </callout>
        <callout arearefs="dsig-object">
          <para>Element <tag>Object</tag> slouží jako kontejner, do kterého je možné přidat
            doplňující informace pro digitální podpis včetně časového razítka XAdES-T.</para>
        </callout>
        <callout arearefs="dsig-xades-qp">
          <para>Element <tag>QualifyingProperties</tag> obaluje všechny informace XAdES.</para>
        </callout>
        <callout arearefs="dsig-xades-target">
          <para>Atribut <tag class="attribute">Target</tag> obsahuje odkaz na digitální podpis,
            kterého se týká časové razítko.</para>
        </callout>
        <callout arearefs="dsig-xades-sp">
          <para>Element <tag>SignedProperties</tag> obaluje veškeré přídavné vlastnosti, které se
            podepisují. Zejména otisk podpisového certifikátu.</para>
        </callout>
        <callout arearefs="dsig-xades-st">
          <para>Čas UTC podepisování dokumentu. Čas musí vyhovovat datovému typu
              <code>dateTime</code> W3C XML schémat.</para>
        </callout>
        <callout arearefs="dsig-xades-sc">
          <para>Informace o podpisovém certifikátu. Element <tag>SigningCertificate</tag> nesmí
            obsahovat atribut <tag class="attribute">Id</tag> (viz <xref linkend="bib.2011-130-eu"
            />) – odpovídající certifikát v elementu <tag>KeyInfo</tag> (viz <coref
              linkend="dsig-ki"/>) je nalezen na základě shody otisku certifikátu (viz <coref
              linkend="dsig-xades-dv"/>).</para>
        </callout>
        <callout arearefs="dsig-xades-dv">
          <para>Hodnota otisku podpisového certifikátu zakódovaná pomocí base64. Otisk se počítá nad
            certifikátem ve formátu ASN.1/DER. Algoritmus pro výpočet otisku je určen předcházejícím
            elementem <tag>DigestMethod</tag>.</para>
        </callout>
        <callout arearefs="dsig-xades-is">
          <para>Element <tag>IssuerSerial</tag> a jeho podelementy identifikují certifikační
              autoritu, která vystavila podpisový certifikát.</para>
        </callout>
        <callout arearefs="dsig-xades-dof">
          <para>Element <tag>DataObjectFormat</tag> se pomocí atributu <tag class="attribute"
              >ObjectReference</tag> odkazuje na element <tag>Reference</tag> (viz <coref
              linkend="dsig-ref1"/>), který do podpisu zahrnuje celý dokument ISDOC. Musí obsahovat
            podelement <tag>MimeType</tag> určující MIME typ odkazovaných dat. V případě formátu
            ISDOC, který používá syntaxi XML, je MIME typ vždy
            <literal>application/xml</literal>.</para>
        </callout>
        <callout arearefs="dsig-xades-ets">
          <para>Element <tag>EncapsulatedTimeStamp</tag> obsahuje samotné časové razítko ve formátu
            ASN.1/DER zakódované pomocí base64.</para>
        </callout>
      </calloutlist>
    </example>
  </section>
  </section>
  <appendix xml:id="poznamky">
    <title>Implementační poznámky</title>
    <section xml:id="poznamky-maximalni-export">
      <title>Zásada exportu maximálního množství informací</title>
      <para>Producent ISDOC by měl do dokumentu ISDOC zapisovat všechny údaje, které má k dispozici
        a je možné je ve formátu ISDOC reprezentovat, i přestože takové údaje mohou být ve formátu
        ISDOC definovány jako nepovinné. Minimálně by se měly zapisovat všechny údaje, které je
        producent schopen zapsat do tiskové podoby dokladu. Například je-li v tiskové podobě faktury
        seznam objednávek, nesmí chybět ani v odpovídajícím dokumentu ISDOC. Uvedení více informací
        v tiskové podobě než v souboru ISDOC by bylo proti smyslu formátu ISDOC.</para>
      <para>Příklady nepovinných údajů a situací, kdy by se měly v dokumentu ISDOC objevit:<itemizedlist>
          <listitem>
            <para>Element <tag>IssuingSystem</tag> – „Identifikace systému, který odesílá/generuje
              fakturu“. Každý systém má nějaké jméno, označení, verzi atd. a neexistuje proto důvod
              pro nevyplnění elementu. Navíc přítomnost takovéto informace umožňuje rychleji zjistit
              „zdroj problémů“, pokud dokument plně neodpovídá standardu ISDOC.</para>
          </listitem>
          <listitem>
            <para>Element <tag>Note</tag> – „Poznámka“. Obsahuje-li systém k danému dokladu nějakou
              poznámku, musí ji na doklad uvést.</para>
          </listitem>
          <listitem>
            <para>Kolekce <tag>OrderReferences</tag> – „Hlavičková kolekce objednávek pro případnou
              vazbu“. Umožňuje-li systém vazby mezi objednávkami a daňovými doklady, musí
              vyexportovat všechny známé vazby s maximem informací. Totéž platí i o řádkových
              kolekcích, kde jsou i položky odkazující, který řádek objednávky konkrétní daňový
              doklad fakturuje. Opět, pokud tuto informaci emitující systém eviduje, musí ji do
              ISDOC uvést.</para>
          </listitem>
        </itemizedlist></para>
    </section>
    <section>
      <title xml:id="poznamky-vypocet-dph">Výpočet DPH</title>
      <para>Zákon předepisuje u daňového dokladu jasně vyjádřené celkové částky daně po jednotlivých
        sazbách. Formát ISDOC proto nevyžaduje, aby součet částek daně na jednotlivých řádkách
        odpovídal hodnotě uvedené v daňovém sumáři (element <tag>TaxTotal</tag>). Pokud je součet po
        řádkách rozdílný od hodnoty v sumáři, má přednost hodnota v sumáři DPH.</para>
      <para>Je věcí konzumenta ISDOC, jak se vyrovná s tím, že příchozí faktura obsahuje v řádcích
        něco jiného než v součtech. Některé implementace mohou například převzít řádky, jak přišly,
        a v případě menších rozdílů oproti sumáři k nim dogenerovat korekční řádek za příslušnou
        sazbu. Další možností je přepočítávání řádků podle obchodních pravidel přijímacího software
        (a tedy jejich korekce) tak, aby v součtu sumáři DPH odpovídaly (tzv. metoda rozpouštění
        rozdílu do řádků). Pokud je rozdíl velmi veliký a nelze jej při nejlepší vůli považovat za
        zaokrouhlovací rozdíl, je také možné upozornit obsluhu, aby tento doklad vůbec neimportovala
        a vrátila jej odesílateli. V tomto případě je velmi vhodné vygenerovat obsluze vytisknutelný
        protokol, který smysluplně popíše, co s čím nesouhlasí, protože obsluha emitující strany
        nemusí být zcela znalá a potřebuje vlastně jen předat pokud možno přesné informace svému
        dodavateli aplikace.</para>
    </section>
    <section>
      <title>Výpočet celkové ceny z jednotkové a počtu kusů</title>
      <para>Toto pravidlo řeší vztah řádkových položek jednotková cena (JC), počet kusů (PK) a
        celková cena (CC). Na řádku nemusí platit, že <inlineequation>
          <mathphrase>JC*PK=CC</mathphrase>
        </inlineequation>. Důležitá pro další zpracování je pouze celková cena. Situace, na které je
        dobře vidět, kdy problém nastane, je prodej velkého počtu kusů o malé jednotkové ceně.
        Například pokud bychom vycházeli z nepatrné jednotkové ceny jednoho špendlíku, která je
        uložena technicky na nějaký počet desetinných míst, tu pak násobili počtem kusů v krabici
        (např. deset tisíc kusů) tak můžeme v celkové ceně dostat velmi veliký rozdíl. A protože
        v reálném světě se prostě krabice špendlíků prodává za celkovou cenu a nikdo neřeší
        jednotkovou cenu jednoho špendlíku, tak se tohoto pravidla drží i ISDOC. Jednotková cena na
        řádku sice existuje, protože je to zákonná povinná položka daňového dokladu, ale její obsah
        je uložen na tolik desetinných míst, na kolik stačí daný výpočetní systém. Neboli může se
        stát, že v konkrétním mezním případě nesouhlasí rovnice <inlineequation>
          <mathphrase>JC*PK=CC</mathphrase>
        </inlineequation>. V tom případě má přednost a do dalších výpočtů postupuje celková cena.
        Další související věcí je zaokrouhlování v případě vizuálního zobrazení faktury, což typicky
        provádějí aplikace typu ISDOC Reader. Tyto aplikace jsou zodpovědné za vizuální stránku
        faktury, takže i kdyby tam emitující systém uložil jednotkovou cenu s vysokou přesností
        (např. „11.25531246654“), tak aby tento řádek vypadal graficky rozumně v porovnání
        s ostatními řádky, musí se před zobrazením zaokrouhlit a opět dojde k porušení rovnice <inlineequation>
          <mathphrase>JC*PK=CC</mathphrase>
        </inlineequation>.</para>
    </section>
    <section>
      <title>Identifikátory</title>
      <para>Údaje s datovým typem <code>UUIDType</code> musí být do dokumentu ISDOC vyplněny
        v souladu s principem jednoznačného identifikátoru UUID. Jedná se o elementy <tag>UUID</tag>
        používané jako identifikátor uvnitř dalších elementů. Například tedy není možné vyplňovat do
        těchto položek prázdný UUID (00000000-0000-0000-0000-000000000000). Ten ač vyhoví kontrole
        v XSD na skladbu této položky, tak v případě posílání více dokladů s prázdným UUID se import
        zachová špatně hned u druhého takového dokladu a prohlásí, že jde o opravu prvního
        dokladu.</para>
      <note>
        <para>Historicky se vyvíjelo i pravidlo v XSD týkající se UUID. Pro verzi ISDOC 5.1 se
          nesmělo jednat o prázdný řetězec. Verze 5.2 dodefinovala syntaktickou skladbu UUID do
          skupin oddělených pomlčkou včetně definice množiny znaků A-Z a 0-9. Verze 5.3 přinesla
          rozšíření položek UUID i o malá písmena, čímž se definice stala kompatibilní s <link
            xlink:href="http://www.ietf.org/rfc/rfc4122.txt">RFC 4122</link>.</para>
      </note>
      <para>Pozor, hodnoty UUID nejsou z principu citlivé na velikost písmen, neboli přijde-li
        jednou tentýž UUID malými písmeny a jednou velkými písmeny, jedná se týž identifikátor a
        tedy totožný doklad. Proto je v případě textového porovnání s již uloženými UUID v databázi
        vhodné tyto položky normalizovat například na tvar „všechna písmena velká“.</para>
    </section>
    <section>
      <title>Vyplňování položek v souladu s legislativou</title>
      <para>U mnoha položek vyplývá z právních předpisů povinnost je vyplnit nějakou hodnotou.
        Pravidla ISDOC však mají být pokud možno na legislativě nezávislá, a proto se zde nesnažíme
        udržovat jejich kompletní přehled. Příklady pravidel:</para>
      <itemizedlist>
        <listitem>
          <para>Element <tag>CompanyID</tag> (DIČ) by měl být u dokladu, který je předmětem DPH,
            vždy vyplněn, protože se jedná o jednu z povinných položek daňového dokladu.</para>
        </listitem>
        <listitem>
          <para>Obdobně element <tag>TaxPointDate</tag> – „Datum zdanitelného plnění“, které by mělo
            být na daňovém dokladu vždy vyplněno. Toto neplatí pro dobropisy a vrubopisy, u nich je
            datem DPH podle zákona datum doručení dokladu protistraně, takže na vystaveném dokladu
            se neuvádí. Pokud nejde o daňový doklad, element se rovněž v dokumentu ISDOC
            nepoužije.</para>
        </listitem>
        <listitem>
          <para>Pokud je odesílajícím subjektem česká firma, musí element
              <tag>Invoice</tag>/<tag>AccountingSupplierParty</tag>/<tag>PostalAddress</tag>/<tag>Country</tag>/<tag>IdentificationCode</tag> v souladu s ISO 3166-1 obsahovat hodnotu „<code>CZ</code>“.</para>
        </listitem>
        <listitem>
          <para>Je vyplněna informace o zápisu v rejstříku
              <tag>Invoice</tag>/<tag>AccountingSupplierParty</tag><tag>RegisterIdentification</tag>.</para>
        </listitem>
      </itemizedlist>
      <para>Obecně lze požadovat, aby doklady splňovaly všechny náležitosti předepsané legislativou
        platnou v zemi vystavitele dokladu.</para>
    </section>
    <section>
      <title>Finanční částky</title>
      <para>Ve finančních položkách všech dokladů používáme typicky vždy kladná čísla s výjimkou
        případu, kdy uvedená hodnota je opravdu záporná. Pravidlo se týká například elementů
          <tag>AlreadyClaimedTaxableAmount</tag>, <tag>AlreadyClaimedTaxAmount</tag>,
          <tag>AlreadyClaimedTaxInclusiveAmount</tag>, <tag>AlreadyClaimedTaxExclusiveAmount</tag>,
          <tag>PaidDepositsAmount</tag>, které se ze své povahy odčítají.</para>
      <para>Konkrétně jsou důležité dvě situace:</para>
      <orderedlist numeration="loweralpha">
        <listitem>
          <para> vztah daňových záloh: </para>
          <para><inlineequation>
              <mathphrase>TaxInclusiveAmount -
                  AlreadyClaimedTaxInclusiveAmount =
                  DifferenceTaxInclusiveAmount</mathphrase>
            </inlineequation></para>
          <para>neboli celková částka s daní – položka předepsané daňové zálohy v kladné částce =
            rozdíl, tj. celková částka k zaplacení s daní.</para>
        </listitem>
        <listitem>
          <para> vztah nedaňových záloh a zaokrouhlení až k částce „k zaplacení“: </para>
          <para><inlineequation>
              <mathphrase>DifferenceTaxInclusiveAmount + PayableRoundingAmount
                - PaidDepositsAmount = PayableAmount</mathphrase>
            </inlineequation></para>
          <para>neboli celková částka k zaplacení s daní + haléřové vyrovnání (zaokrouhlení) -
            zaplacené nedaňové zálohy = částka k zaplacení.</para>
        </listitem>
      </orderedlist>
      <para>Poslední, co v této souvislosti můžeme zmínit je situace dokladů typu
          (<tag>DocumentType</tag>) 2 a 6, tzn. dobropis faktury a dobropis daňového zálohového
        listu. I v těchto případech je doklad dobropisu v kladných částkách a až jeho povaha (tedy
        fakt, že jde o dobropis) naznačují, že všechna čísla je od původní faktury vlastně třeba
        odečíst. Dobropis jako takový je ale vždy v kladných částkách. Toto pravidlo bylo
        formulováno a stalo se závazné s verzí 5.2.1. Uvedená hodnota má být na faktuře opravdu
        záporná pouze v případě, když se někdo snaží tímto způsobem udělat dobropis. Pokud tím
        neklesne částka celého dokladu do záporu (jinak řečeno pokud takové položky jsou
        v minoritě), nelze proti tomu nic namítat, protože tento postup praxe používá a ISDOC na to
        musí umět reagovat. Pokud by ale záporná měla být většina položek, je třeba jít už cestou
        skutečného dobropisu (a tedy tato většina bude uvedena kladně, zatímco „menšinové“ položky
        budou záporně).</para>
    </section>
    <section>
      <title>Použití typů UUIDType a ID36Type</title>
      <para>Ve formátu ISDOC existují elementy typu UUIDType a vedle nich elementy typu ID36Type.
        Důvodem je, že některé položky musí být unikátní v rámci celého světa, typicky hlavičkový
        identifikátor dokladu. Pod tímto identifikátorem doklad putuje vnějším světem a nesmí se
        stát, že by se vyskytly na světě dva doklady se stejnou identifikací. Jiné položky,
        například unikátní identifikátor řádku ID (element
          <tag>Invoice/InvoiceLines/InvoiceLine/ID</tag>), musí zaručit unikátnost řádku jen v rámci
        jednoho dokladu. Teoreticky by tedy stačilo definovat například osmi znakovou položku a
        publikovat, že jde o unikátní identifikátor řádku v rámci dokladu. Protože ale některé
        informační systémy jsou již navrženy robustně a mohou i na identifikátory řádků používat
        UUID, zatímco jiné systémy mohou používat třeba jen pořadová čísla, bylo třeba vymyslet
        takový způsob, který by všem dovolil do výsledného souboru ISDOC uložit hodnotu použitou
        v daném ekonomickém systému. Ideální je tedy znaková položka o maximální délce 36 znaků, kam
        si každý odesílací systém uloží, co používá. Podstatné je, že ručí za unikátnost v rámci
        jednoho dokladu.</para>
    </section>
    <section>
      <title>Uživatelské elementy</title>
      <para>Uživatelské elementy existují v ISDOC hlavičkové a řádkové. Uživatelské elementy a
        jejich obsah nejsou kontrolovány pomocí XML schématu a je tedy možné si do nich uložit
        jakoukoliv strukturu XML. Tyto elementy nemají obsahovat žádná „oficiální“ data (tj. data,
        která by měly využívat všechny systémy) – taková by patřila do společné nové verze formátu.
        Uživatelské elementy jsou určeny pro konkrétní implementace, kdy se příjemce a vystavitel
        dohodnou na jejich použití (v praxi se samozřejmě spíše dohodnou jejich IT dodavatelé, pokud
        to není rovnou tentýž subjekt). Podstatné ale je, že při konstrukci jmen a jmenného prostoru
        uživatelských elementů je třeba dodržovat určitou kázeň, aby se nemohlo stát, že dvě různé
        implementace použijí stejně pojmenovaný element. Jmenný prostor uživatelského elementu proto
        musí být unikátní, typicky obsahuje internetovou doménu realizační firmy. Příklad použití
        uživatelského elementu: </para>
      <programlisting>&lt;Extensions>
  &lt;extenze:AdditionalDiscount
      xmlns:extenze="http://abra.eu/praha/divize415/novak/projekt_zakaznicke_slevy_na_poukazy"
      >10&lt;/extenze:AdditionalDiscount>
&lt;/Extensions></programlisting>
      <para>Obdobně fungují i řádkové uživatelské elementy. Navíc je potřeba počítat s tím, že nelze
        vyžadovat přítomnost uživatelských elementů na všech řádcích. Přijímací systém musí být
        připraven na to, že uživatelské elementy součástí faktury vůbec nebudou.</para>
      <para>Kolem uživatelských položek je poměrně velká praktická zkušenost, někdy i negativní, kdy
        se například systémy EDI kvůli uživatelským položkám rozjely do několika tzv. subsetů, na
        jejichž překlad je třeba speciálních můstků nebo nemusí být vůbec možný. Proto ISDOC
        přistoupil k uživatelským položkám jinak. Na jaře 2010 byla i do aplikací typu ISDOC Reader
        doplněna schopnost zobrazit obsah uživatelských elementů, což dovoluje všem si vůbec
        povšimnout, že tam nějaká uživatelská data jsou.</para>
    </section>
    <section>
      <title>Zúčtovací faktura</title>
      <para>Ve zúčtovací faktuře se v kolekci <tag>NonTaxedDeposits</tag> nedaňová zálohová faktura
        uvádí pouze v případě, že byla zaplacena (a tudíž je třeba tuto zaplacenou částku odečíst od
        částky k zaplacení), ale současně nebyla importována do daňové zálohy, která by mohla být
        v kolekci <tag>TaxedDeposits</tag>. V tom případě by se totiž odečítala jednou z principu
        nedaňové zálohy a současně z principu odečtu zdaněné zálohy a to by byla chyba. Pokud je
        daná nedaňová záloha vztažena do daňového zálohového listu, tak se sám tento daňový zálohový
        list odečítá ve zúčtovací faktuře a nedaňová záloha již ne. Typické použití je, že doklad
        daňový zálohový list má kolekci nedaňových zálohových listů (zaplacených) a není třeba jej
        platit. A pokud se tento daňový zálohový list použije ve zúčtovací faktuře v kolekci
          <tag>TaxedDeposits</tag>, tak se odečte v příslušné kolekci a na konci není třeba zaplatit
        nic.</para>
    </section>
    <section>
      <title>Vztahy mezi údaji uváděnými uvnitř elementů <tag>TaxTotal</tag> a
          <tag>TaxSubTotal</tag></title>
      <para>Pro všechny údaje uváděné v sumáři DPH (element <tag>TaxSubTotal</tag>) musí v místní,
        případně cizí měně platit: </para>
      <para><inlineequation>
          <mathphrase>TaxableAmount + TaxAmount = TaxInclusiveAmount</mathphrase>
        </inlineequation></para>
      <para><inlineequation>
          <mathphrase>AlreadyClaimedTaxableAmount + AlreadyClaimedTaxAmount =
            AlreadyClaimedTaxInclusiveAmount</mathphrase>
        </inlineequation></para>
      <para><inlineequation>
          <mathphrase>DifferenceTaxableAmount + DifferenceTaxAmount =
            DifferenceTaxInclusiveAmount.</mathphrase>
        </inlineequation>
      </para>
      <para>Pro celkové položky daně v sumáři DPH <tag>TaxTotal</tag> musí platit, že se rovnají
        součtu daní za každou sazbu tj. za každou kolekci <tag>TaxSubTotal</tag> a to včetně cizí
        měny, pokud je použita. Tedy:</para>
      <para><inlineequation>
          <mathphrase>TaxTotal/TaxAmount = SUM(TaxSubtotal/TaxAmount)</mathphrase>
        </inlineequation></para>
    </section>
    <section>
      <title>Vztahy mezi údaji uvnitř elementu <tag>LegalMonetaryTotal</tag></title>
      <para>Uvnitř celkového sumáře <tag>LegalMonetaryTotal</tag> musí jednotlivé položky souhlasit
        se součty položek v příslušné sazbě (za všechny kolekce <tag>TaxSubTotal</tag>). Pro všechny
        musí v místní, případně cizí měně platit:</para>
      <para><inlineequation>
          <mathphrase>LegalMonetaryTotal/TaxExclusiveAmount = SUM
            (TaxSubTotal/TaxableAmount)</mathphrase>
        </inlineequation></para>
      <para><inlineequation>
          <mathphrase>LegalMonetaryTotal/TaxInclusiveAmount = SUM
            (TaxSubTotal/TaxInclusiveAmount)</mathphrase>
        </inlineequation></para>
      <para><inlineequation>
          <mathphrase>LegalMonetaryTotal/AlreadyClaimedTaxExclusiveAmount = SUM
            (TaxSubTotal/AlreadyClaimedTaxableAmount)</mathphrase>
        </inlineequation></para>
      <para><inlineequation>
          <mathphrase>LegalMonetaryTotal/AlreadyClaimedTaxInclusiveAmount = SUM
            (TaxSubTotal/AlreadyClaimedTaxInclusiveAmount)</mathphrase>
        </inlineequation></para>
      <para><inlineequation>
          <mathphrase>LegalMonetaryTotal/DifferenceTaxExclusiveAmount = SUM
            (TaxSubTotal/DifferenceTaxableAmount) </mathphrase>
        </inlineequation></para>
      <para><inlineequation>
          <mathphrase>LegalMonetaryTotal/DifferenceTaxInclusiveAmount = SUM
            (TaxSubTotal/DifferenceTaxInclusiveAmount)</mathphrase>
        </inlineequation></para>
    </section>
    <section>
      <title>Identifikace zápisu v rejstříku</title>
      <para>Někteří producenti elektronických faktur mají problém s naplněním elementů
          <tag>RegisterKeptAt</tag>, <tag>RegisterFileRef</tag> a <tag>RegisterDate</tag>, protože
        údaje mají uložené jako jednu položku. Formát ISDOC proto alternativně umožňuje informaci
        o zápisu do rejstříku uvést jako jeden řetězec v elementu <tag>Preformatted</tag>. Emitující
        systém si může vybrat jeden z těchto dvou způsobů reprezentace zápisu do rejstříku. Příjemce
        dokumentů ISDOC se musí vyrovnat s oběma způsoby.</para>
    </section>
    <section>
      <title>Informace o platbě</title>
      <para>Element <tag>PaymentMeans</tag> (podrobnosti platby) není povinný. Vynechat ho lze
        například v situaci, kdy je doklad placený v hotovosti a hotovostní doklad ještě neexistuje
        (a jeho název nelze tedy uvést do povinného podelementu <tag>Details</tag>). Pro příjemce je
        to pokyn <quote>nic neplatit</quote>, což je žádoucí u všech jiných způsobů platby než
        bankovním účtem.</para>
      <para>Dalším typickým případem neuvedení elementu <tag>PaymentMeans</tag> je použití ISDOC pro
        daňový zálohový list. Zde totiž nepřipadá v úvahu, že by měl být nějak placen, naopak on sám
        se dělá pouze na přijatou platbu nedaňového zálohového listu, a předpokládá se tedy, že bude
        obsahovat odpovídající částky v elementu <tag>NonTaxedDeposits</tag>.</para>
    </section>
    <section>
      <title>Vizuální podoba dokumentu</title>
      <para>Je-li součástí dokumentu ISDOC reprezentovaného jako archiv
          (<filename>.isdocx</filename>) také jeho vizuální podoba, doporučuje se pro ni použít
        formát PDF. Lze použít i další formáty ukládající vizuální podobu dokumentu (např. HTML,
        formáty MS Word, MS Excel, obrázky JPEG, GIF, PNG, BMP, atd.). Musí však platit, že příloha
        označená jako „vizuální podoba dokumentu“, musí být skutečně jeho vizuální podoba. Záměr je
        mít pouze jednu vizuální podobu dokumentu, a proto v elementu <tag>SupplementsList</tag>
        může být pouze jediný element <tag>Supplement</tag> s atributem
        <code>preview="true"</code>.</para>
    </section>    
  </appendix>
  <appendix xml:id="schema">
    <title>Schémata pro jednotlivé typy dokumentů</title>
    <section xml:id="schema-invoice">
      <title>Schéma pro daňový doklad – <filename condition="html" xlink:href="../xsd/isdoc-invoice-@VERSION@.xsd">isdoc-invoice-@VERSION@.xsd</filename><filename condition="print">isdoc-invoice-@VERSION@.xsd</filename></title>
      <note>
        <para>Přehledný grafický diagram schématu je dostupný na adrese <link xlink:href="http://isdoc.cz/@VERSION@/doc-cs/isdoc-invoice-@VERSION@.html"/>.</para>
      </note>
      <programlisting condition="print" role="small"><textobject><textdata fileref="../xsd/isdoc-invoice-@VERSION@.xsd" encoding="utf-8"></textdata></textobject></programlisting>
    </section>
    <section xml:id="schema-commondocument">
      <title>Schéma pro neplatební dokument – <filename condition="html" xlink:href="../xsd/isdoc-commondocument-@VERSION@.xsd">isdoc-commondocument-@VERSION@.xsd</filename><filename condition="print">isdoc-commondocument-@VERSION@.xsd</filename></title>
      <note>
        <para>Přehledný grafický diagram schématu je dostupný na adrese <link xlink:href="http://isdoc.cz/@VERSION@/doc-cs/isdoc-commondocument-@VERSION@.html"/>.</para>
      </note>
      <programlisting condition="print" role="small"><textobject><textdata fileref="../xsd/isdoc-commondocument-@VERSION@.xsd" encoding="utf-8"></textdata></textobject></programlisting>
    </section>
    <section xml:id="schema-manifest">
      <title>Schéma pro manifest – <filename condition="html" xlink:href="../xsd/isdoc-manifest-@VERSION@.xsd">isdoc-manifest-@VERSION@.xsd</filename><filename condition="print">isdoc-manifest-@VERSION@.xsd</filename></title>
      <programlisting condition="print" role="small"><textobject><textdata fileref="../xsd/isdoc-manifest-@VERSION@.xsd" encoding="utf-8"></textdata></textobject></programlisting>
    </section>
  </appendix>
  <appendix xml:id="schematron">
    <title>Schéma pro kontrolu vybraných pravidel – <filename condition="html" xlink:href="../sch/isdoc-@VERSION@.sch">isdoc-@VERSION@.sch</filename><filename condition="print">isdoc-@VERSION@.sch</filename></title>
    <programlisting role="small" language="xml"><textobject><textdata fileref="../sch/isdoc-@VERSION@.sch" encoding="utf-8"></textdata></textobject></programlisting>    
  </appendix>
  <xi:include href="changelog-cs.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <appendix>  
    <title>Možné změny pro další verze</title>
    <para>Následující seznam obsahuje navrhované změny a rozšíření pro některou z dalších verzí
      ISDOC.</para>
    <itemizedlist>
      <listitem revision="6.0.2">
        <para>Další verze ISDOC bude podporovat další typy dokumentů objednávka a potvrzení objednávky.</para>
      </listitem>
      <listitem>
        <para>Zvažujeme přidání nového typu dokumentu, který bude sloužit jako kontejner pro uložení
          a přenos více dokumentů najednou, například při dávkovém zpracování.</para>
      </listitem>
    </itemizedlist>
  </appendix>
  
  <bibliography>
    <title>Reference</title>
    <bibliomixed xml:id="bib.appnote"><abbrev>APPNOTE</abbrev><title>APPNOTE.TXT – .ZIP File Format Specification.</title> September 2007. PKWARE Inc. Dostupné na URL: <bibliomisc><link xlink:href="http://www.pkware.com/documents/APPNOTE/APPNOTE-6.3.2.TXT"/></bibliomisc></bibliomixed>
    <bibliomixed xml:id="bib.rfc4051"><abbrev>RFC4051</abbrev><title>Additional XML Security Uniform
        Resource Identifiers (URIs).</title> April 2005. IETF. Dostupné na URL: <bibliomisc><link
          xlink:href="http://www.ietf.org/rfc/rfc4051.txt"/></bibliomisc></bibliomixed>
    <bibliomixed xml:id="bib.xml"><abbrev>XML</abbrev><title>Extensible Markup Language (XML) 1.0
        (Fifth Edition).</title> W3C Recommendation. 26 November 2008. W3C. Dostupné na URL:
          <bibliomisc><link xlink:href="http://www.w3.org/TR/REC-xml/"/></bibliomisc></bibliomixed>
    <bibliomixed xml:id="bib.xades"><abbrev>XAdES</abbrev><title>ETSI TS 101 903 V1.4.1: XML
        Advanced Electronic Signatures (XAdES)</title> Technical Specification. June 2009. ETSI.
      Dostupné na URL: <bibliomisc><link
          xlink:href="http://uri.etsi.org/01903/v1.4.1/ts_101903v010401p.pdf"
      /></bibliomisc></bibliomixed>
    <bibliomixed xml:id="bib.2011-130-eu"><abbrev>2011/130/EU</abbrev>
      <title>COMMISSION DECISION of 25 February 2011 establishing minimum requirements for the
        cross-border processing of documents signed electronically by competent authorities under
        Directive 2006/123/EC of the European Parliament and of the Council on services in the
        internal market</title>. Dostupné na URL:
          <bibliomisc><link xlink:href="http://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=OJ:L:2011:053:0066:0072:EN:PDF"/></bibliomisc><footnote>
        <para>Kvůli chybám v českém překladu doporučujeme vycházet z anglické verze rozhodnutí
          komise.</para>
      </footnote></bibliomixed>
    <bibliomixed xml:id="bib.cba29"><abbrev>ČBA-STD-29</abbrev><title>Standard elektronické fakturace – Popis rozhraní pro zasílání
      e-faktur a e-dokumentů koncovým spotřebitelům do aplikací elektronického bankovnictví</title>.
      2014. Česká bankovní asociace.
    </bibliomixed>
    <bibliomixed xml:id="bib.rfc1951"><abbrev>RFC1951</abbrev><title>DEFLATE Compressed Data Format Specification version 1.3</title>
      May 1996. IETF. Dostupné na URL:
      <bibliomisc><link xlink:href="http://www.ietf.org/rfc/rfc1951.txt"
      /></bibliomisc></bibliomixed>
    <bibliomixed xml:id="bib.rfc3161"><abbrev>RFC3161</abbrev><title>Internet X.509 Public Key
        Infrastructure Time-Stamp Protocol (TSP)</title> August 2001. IETF. Dostupné na URL:
          <bibliomisc><link xlink:href="http://www.ietf.org/rfc/rfc3161.txt"
      /></bibliomisc></bibliomixed>
    <bibliomixed xml:id="bib.xmldsig-core"><abbrev>XMLDSig-Core</abbrev><title>XML Signature Syntax
        and Processing (Second Edition).</title> W3C Recommendation. 10 June 2008. W3C. Dostupné na
      URL: <bibliomisc><link xlink:href="http://www.w3.org/TR/xmldsig-core/"
      /></bibliomisc></bibliomixed>
  </bibliography>
  
</article>
